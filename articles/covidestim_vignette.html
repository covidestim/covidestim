<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Using Covidestim • covidestim</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Using Covidestim">
<meta property="og:description" content="covidestim">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">covidestim</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.1.0000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/covidestim_vignette.html">Using Covidestim</a>
    </li>
    <li>
      <a href="../articles/results.html">Results Object</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/covidestim/covidestim/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="covidestim_vignette_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Using Covidestim</h1>
                        <h4 class="author">Melanie H. Chitwood, Marcus Russi</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/covidestim/covidestim/blob/master/vignettes/covidestim_vignette.Rmd"><code>vignettes/covidestim_vignette.Rmd</code></a></small>
      <div class="hidden name"><code>covidestim_vignette.Rmd</code></div>

    </div>

    
    
<p>This vignette demonstrates running the model on NYC data and viewing the result.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://covidestim.org">covidestim</a></span><span class="op">)</span></code></pre></div>
<div id="running-the-model" class="section level2">
<h2 class="hasAnchor">
<a href="#running-the-model" class="anchor"></a>Running the model</h2>
<div id="data" class="section level3">
<h3 class="hasAnchor">
<a href="#data" class="anchor"></a>Data</h3>
<p>We will demonstrate how to use the covidestim package using data from the early NYC epidemic that the package makes available through the <code><a href="../reference/example_nyc_data.html">example_nyc_data()</a></code> function.</p>
<p>Users can use case and/or death data with the model. Each data type should be entered as its own dataframe with two columns: <code>date</code> and <code>observation</code>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="fu"><a href="../reference/example_nyc_data.html">example_nyc_data</a></span><span class="op">(</span><span class="st">'cases'</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 6 x 2</span>
<span class="co">#&gt;   date       observation</span>
<span class="co">#&gt;   &lt;date&gt;           &lt;dbl&gt;</span>
<span class="co">#&gt; 1 2020-02-29           1</span>
<span class="co">#&gt; 2 2020-03-01           0</span>
<span class="co">#&gt; 3 2020-03-02           0</span>
<span class="co">#&gt; 4 2020-03-03           2</span>
<span class="co">#&gt; 5 2020-03-04           5</span>
<span class="co">#&gt; 6 2020-03-05           3</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="fu"><a href="../reference/example_nyc_data.html">example_nyc_data</a></span><span class="op">(</span><span class="st">'deaths'</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 6 x 2</span>
<span class="co">#&gt;   date       observation</span>
<span class="co">#&gt;   &lt;date&gt;           &lt;dbl&gt;</span>
<span class="co">#&gt; 1 2020-02-29           0</span>
<span class="co">#&gt; 2 2020-03-01           0</span>
<span class="co">#&gt; 3 2020-03-02           0</span>
<span class="co">#&gt; 4 2020-03-03           0</span>
<span class="co">#&gt; 5 2020-03-04           0</span>
<span class="co">#&gt; 6 2020-03-05           0</span></code></pre></div>
</div>
<div id="generate-a-model-configuration" class="section level3">
<h3 class="hasAnchor">
<a href="#generate-a-model-configuration" class="anchor"></a>Generate a model configuration</h3>
<p>Input data and model run options are summarized into a covidestim configuration with the function call <code><a href="../reference/covidestim.html">?covidestim</a></code>. Users must specify the number of days of data in the input data. More information on data input can be accessed at <code><a href="../reference/input_cases.html">?input_cases</a></code> and <code><a href="../reference/input_cases.html">?input_deaths</a></code>. Printing the result of <code><a href="../reference/covidestim.html">covidestim()</a></code> will produce a summary of model run conditions, priors, and data inputs.</p>
<p>Input data and model configuration options are rolled up into a model configuration object as follows:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cases</span>  <span class="op">&lt;-</span> <span class="fu"><a href="../reference/example_nyc_data.html">example_nyc_data</a></span><span class="op">(</span><span class="st">'cases'</span><span class="op">)</span>
<span class="va">deaths</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/example_nyc_data.html">example_nyc_data</a></span><span class="op">(</span><span class="st">'deaths'</span><span class="op">)</span>

<span class="va">cfg</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/covidestim.html">covidestim</a></span><span class="op">(</span>ndays <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">cases</span><span class="op">)</span>, region <span class="op">=</span> <span class="st">'New York'</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="../reference/input_cases.html">input_cases</a></span><span class="op">(</span><span class="va">cases</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="../reference/input_cases.html">input_deaths</a></span><span class="op">(</span><span class="va">deaths</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">cfg</span><span class="op">)</span>
<span class="co">#&gt; Covidestim Configuration:</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Seed:    42</span>
<span class="co">#&gt; Chains:  3</span>
<span class="co">#&gt; Iterations:  1500</span>
<span class="co">#&gt; Warmup runs: 1200</span>
<span class="co">#&gt; Priors: Valid</span>
<span class="co">#&gt; ndays:   120</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Priors:</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  log_new_inf_0_mu    0</span>
<span class="co">#&gt;  log_new_inf_0_sd    10</span>
<span class="co">#&gt;  logRt_mu    0</span>
<span class="co">#&gt;  logRt_sd    3</span>
<span class="co">#&gt;  inf_imported_mu 0</span>
<span class="co">#&gt;  inf_imported_sd 0.6265664160401</span>
<span class="co">#&gt;  deriv1_spl_par_sd   0.5</span>
<span class="co">#&gt;  deriv2_spl_par_sd   0.1</span>
<span class="co">#&gt;  p_sym_if_inf    [alpha] 5.143</span>
<span class="co">#&gt;  p_sym_if_inf    [beta]  3.536</span>
<span class="co">#&gt;  p_sev_if_sym    [alpha] 1.8854</span>
<span class="co">#&gt;  p_sev_if_sym    [beta]  20.002</span>
<span class="co">#&gt;  p_die_if_sev    [alpha] 28.239</span>
<span class="co">#&gt;  p_die_if_sev    [beta]  162.3</span>
<span class="co">#&gt;  p_die_if_inf    [alpha] 15.915</span>
<span class="co">#&gt;  p_die_if_inf    [beta]  3167.1</span>
<span class="co">#&gt;  ifr_decl_OR [alpha] 9.1357</span>
<span class="co">#&gt;  ifr_decl_OR [beta]  29.339</span>
<span class="co">#&gt;  inf_prg_delay   [shape] 3.413</span>
<span class="co">#&gt;  inf_prg_delay   [rate]  0.6051</span>
<span class="co">#&gt;  sym_prg_delay   [shape] 1.624</span>
<span class="co">#&gt;  sym_prg_delay   [rate]  0.2175</span>
<span class="co">#&gt;  sev_prg_delay   [shape] 2.061</span>
<span class="co">#&gt;  sev_prg_delay   [rate]  0.2277</span>
<span class="co">#&gt;  serial_i    [shape] 129.1</span>
<span class="co">#&gt;  serial_i    [rate]  22.25</span>
<span class="co">#&gt;  rr_diag [alpha]sy_vs_sym_a  2</span>
<span class="co">#&gt;  rr_diag [alpha]sy_vs_sym    [beta]  18</span>
<span class="co">#&gt;  rr_diag_sym_vs_sev  [alpha] 2</span>
<span class="co">#&gt;  rr_diag_sym_vs_sev  [beta]  2</span>
<span class="co">#&gt;  p_diag_if_sev   [alpha] 5</span>
<span class="co">#&gt;  p_diag_if_sev   [beta]  2</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Inputs:</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  [ 120]  Cases</span>
<span class="co">#&gt;  [ 120]  Deaths</span></code></pre></div>
<p>There are a few possible variations on this:</p>
<ol style="list-style-type: decimal">
<li><p>Custom priors can be set by adding them, just as <code><a href="../reference/input_cases.html">input_cases()</a></code> and <code><a href="../reference/input_cases.html">input_deaths()</a></code> were added.</p></li>
<li><p>A population size can be set, to make the model aware of an upper bound on how many individuals could be infected.</p></li>
<li><p><code><a href="../reference/input_cases.html">input_cases()</a></code> and <code><a href="../reference/input_cases.html">input_deaths()</a></code> can accept a second parameter, <code>type</code>, to specify if the data is organized by date-of-report, or date-of-event.</p></li>
</ol>
<p>If you set custom priors, be sure to check the output of <code><a href="https://rdrr.io/r/base/print.html">print(cfg)</a></code> to see that your prior is present in the configuration.</p>
</div>
<div id="initializing-a-model-run" class="section level3">
<h3 class="hasAnchor">
<a href="#initializing-a-model-run" class="anchor"></a>Initializing a model run</h3>
<p>Finally, the model is run with the function <code><a href="../reference/run.covidestim.html">?run.covidestim</a></code>. Don’t forget to assign the a name to the output of the run - you could lose it!. Runtimes vary depending on the size and quality of the data, and may take over an hour. If you are running the model in an interactive environment like RStudio, periodic status updates will appear in the console. Here, we will use the BFGS algorithm to quickly produce a result, as NUTS, the method used by <code>run()</code>, takes longer.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu">runOptimizer</span><span class="op">(</span><span class="va">cfg</span><span class="op">)</span>
<span class="co">#&gt; Finished try #1 in 1.6s with exit code 0</span>
<span class="co">#&gt; Finished try #2 in 2.4s with exit code 0</span>
<span class="co">#&gt; Finished try #3 in 1.9s with exit code 0</span>
<span class="co">#&gt; Finished try #4 in 3.1s with exit code 0</span>
<span class="co">#&gt; Finished try #5 in 2.3s with exit code 0</span>
<span class="co">#&gt; Finished try #6 in 1.9s with exit code 0</span>
<span class="co">#&gt; Finished try #7 in 1.7s with exit code 0</span>
<span class="co">#&gt; Finished try #8 in 1.9s with exit code 0</span>
<span class="co">#&gt; Finished try #9 in 2.8s with exit code 0</span>
<span class="co">#&gt; Finished try #10 in 1.7s with exit code 0</span></code></pre></div>
<p>Typically, BFGS will occasionally fail to converge. This is what causes the non-zero return codes. <code><a href="../reference/runOptimizer.covidestim.html">runOptimizer.covidestim()</a></code> will automatically exclude these, and select the BFGS run that maximizes the posterior.</p>
</div>
</div>
<div id="accessing-model-output" class="section level2">
<h2 class="hasAnchor">
<a href="#accessing-model-output" class="anchor"></a>Accessing model output</h2>
<p>Calling <code>run()</code> or <code>runOptimizer()</code> on a valid covidestim configuration will produce an S3 object of class <code>covidestim_result</code>. Here, we describe the summary functions in covidestim to view model results. In the vignette <code><a href="../articles/results.html">vignette("results")</a></code>, we describe the various objects within <code>covidestim_result</code>. However, most users will likely find that the <code><a href="../reference/summary.covidestim_result.html">summary.covidestim_result()</a></code> function provides all the information they need.</p>
<div id="summarizing-covidestim-output" class="section level3">
<h3 class="hasAnchor">
<a href="#summarizing-covidestim-output" class="anchor"></a>Summarizing covidestim output</h3>
<p>A covidestim object can be easily converted to a summary data frame with the <code><a href="../reference/summary.covidestim_result.html">?summary.covidestim_result</a></code> function. Each row of the data frame is a date. Each column of the data frame is a value of interest. Variables appened with .hi or .lo indicate the 0.975 and 0.025 quantiles, respectively.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">result.summary</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">result.summary</span><span class="op">[</span><span class="fl">40</span><span class="op">:</span><span class="fl">45</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 6 x 5</span>
<span class="co">#&gt;   date       cases.fitted cases.fitted.hi cases.fitted.lo cum.incidence</span>
<span class="co">#&gt;   &lt;date&gt;            &lt;dbl&gt; &lt;lgl&gt;           &lt;lgl&gt;                   &lt;dbl&gt;</span>
<span class="co">#&gt; 1 2020-03-11         192. NA              NA                    162890.</span>
<span class="co">#&gt; 2 2020-03-12         291. NA              NA                    226912.</span>
<span class="co">#&gt; 3 2020-03-13         427. NA              NA                    307625.</span>
<span class="co">#&gt; 4 2020-03-14         608. NA              NA                    406064.</span>
<span class="co">#&gt; 5 2020-03-15         842. NA              NA                    522268.</span>
<span class="co">#&gt; 6 2020-03-16        1134. NA              NA                    655150.</span></code></pre></div>
</div>
</div>
<div id="visualizing-model-output" class="section level2">
<h2 class="hasAnchor">
<a href="#visualizing-model-output" class="anchor"></a>Visualizing model output</h2>
<p>Model results can be visualized with <code>?viz</code>. Two figures will be produced.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">plots</span> <span class="op">&lt;-</span> <span class="fu">viz</span><span class="op">(</span><span class="va">result</span><span class="op">)</span></code></pre></div>
<p>The figure ‘observedVsFitted’ plots the observed cases and deaths (the input data) against the modeled values for reported cases and deaths. Because <code>runOptimzier.covidestim_result()</code> does not have CI’s, there will be a warning relating to the <code>NA</code>-valued CI columns that are present in the output.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">plots</span><span class="op">$</span><span class="va">observedVsFitted</span>
<span class="co">#&gt; Warning in max(ids, na.rm = TRUE): no non-missing arguments to max; returning -</span>
<span class="co">#&gt; Inf</span>

<span class="co">#&gt; Warning in max(ids, na.rm = TRUE): no non-missing arguments to max; returning -</span>
<span class="co">#&gt; Inf</span></code></pre></div>
<p><img src="covidestim_vignette_files/figure-html/unnamed-chunk-7-1.png" width="700"></p>
<p>The figure ‘infectionsAndCases’ plots modeled reported cases against modeled ‘true’ new infections. The latter is what we estimate to be the complete, un-lagged time series of incident infections that would give rise to the trends we observe in the case and death data.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">plots</span><span class="op">$</span><span class="va">infectionsAndCases</span>
<span class="co">#&gt; Warning in max(ids, na.rm = TRUE): no non-missing arguments to max; returning -</span>
<span class="co">#&gt; Inf</span></code></pre></div>
<p><img src="covidestim_vignette_files/figure-html/unnamed-chunk-8-1.png" width="700"></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Marcus Russi, Melanie Chitwood.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
